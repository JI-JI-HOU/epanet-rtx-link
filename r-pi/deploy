# dockerfile for running rtx-link application on raspberry pi
FROM armv7/armhf-ubuntu:16.10
MAINTAINER Sam Hatchett <sam@citilogics.com>

RUN apt-get update && \
	apt-get install -y libiodbc2 tdsodbc openssl libsqlite3-dev curl

# install NODEJS - runtime for LINK frontend application
RUN curl -sL https://deb.nodesource.com/setup_8.x | bash && \
	apt-get -y install nodejs

# setup tds as odbc driver - allows connection to MSSQL hosts
COPY odbcinst.ini /etc/odbcinst.ini

# copy the frontend and service binary
COPY epanet-rtx/examples/LINK/frontend /app
COPY link-server /app/srv/linux/link-server

WORKDIR /app

# install node frontend application and dependencies
RUN npm install

EXPOSE 8585
VOLUME /root/rtx_link
CMD [ "nodejs", "server.js" ]
